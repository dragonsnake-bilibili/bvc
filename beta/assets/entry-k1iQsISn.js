import{_ as P,b as S,r as G}from"./ParagraphDisplay.vue_vue_type_script_setup_true_lang-Cg7Y1RDg.js";import{aj as H}from"./resizeObserver-B_eoUIIx.js";import{u as k}from"./emotes-DeEw5HnO.js";import{V as O}from"./VAvatar-DYoKWv_6.js";import{d as y,c as b,B as u,m as c,x as n,g as f,R as _,y as Q,u as h,M as B,l as M,q as m,o as T,r as W}from"./pinia-CYavoQC1.js";import{_ as J,A as p,z as I,U as v}from"./VTextField-dhpxJfRw.js";import{v as K}from"./VColorPicker-DcrqMdfC.js";import{p as X,c as z,b as Y}from"./rendering-CVLbwh7J.js";import"./dialog-Buob4eiQ.js";import"./tag-DEJUn8pt.js";const w="极简紧凑";function Z(t){if(t.themed.theme!==w){const e={name_color:"#ffffff"};t.themed.content={...e}}}const ee={class:"chat-container container"},ae={class:"user-info"},te={class:"username"},oe=["src"],se=["src"],le=["src"],re=["src"],ne=y({__name:"Display",props:{chatConfig:{},globalConfig:{}},setup(t){H(s=>({v75b58d8b:`${a.value.avatar_gap}px`,v459232b8:o.value.themed.name_color,v7465d2eb:`${a.value.content_gap}px`,v36475f03:`${a.value.username_to_badge}px`,v2b2bb815:`${a.value.badge_gap}px`}));const e=k(),l=t,o=b(()=>({shared:l.chatConfig.shared,themed:l.chatConfig.themed.content})),a=b(()=>l.globalConfig.content);return(s,r)=>{const i=P;return c(),u("div",ee,[n(O,{class:"chat-avatar",image:o.value.shared.avatar},null,8,["image"]),f("div",null,[f("span",ae,[f("span",te,Q(o.value.shared.username)+"：",1),o.value.shared.logos.manager?(c(),u("img",{key:0,class:"chat-logo",src:h(e).find_emote("special/房管")},null,8,oe)):_("",!0),o.value.shared.logos.governor?(c(),u("img",{key:1,class:"chat-logo",src:h(e).find_emote("special/总督")},null,8,se)):_("",!0),o.value.shared.logos.admiral?(c(),u("img",{key:2,class:"chat-logo",src:h(e).find_emote("special/提督")},null,8,le)):_("",!0),o.value.shared.logos.captain?(c(),u("img",{key:3,class:"chat-logo",src:h(e).find_emote("special/舰长")},null,8,re)):_("",!0)]),n(i,{paragraph:o.value.shared.content},null,8,["paragraph"])])])}}}),ie=J(ne,[["__scopeId","data-v-587bca9c"]]),de=y({__name:"Editor",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(t){const e=B(t,"modelValue"),l=b(()=>e.value.content);return(o,a)=>(c(),M(I,null,{default:m(()=>[n(p,{class:"mx-auto",cols:"6"},{default:m(()=>[f("div",null,[a[1]||(a[1]=f("p",{style:{"text-align":"center"}},"用户名颜色",-1)),n(K,{modelValue:l.value.name_color,"onUpdate:modelValue":a[0]||(a[0]=s=>l.value.name_color=s),class:"mx-auto","show-swatches":"",swatches:[["#25885B"],["#638CF8"],["#FFFFFF"]]},null,8,["modelValue"])])]),_:1})]),_:1}))}}),ce=y({__name:"GlobalConfig",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(t){const e=B(t,"modelValue"),l={avatar_gap:8,username_to_badge:4,content_gap:12,badge_gap:8},o=W(!1);T(()=>{e.value.theme!==w&&(e.value.theme=w,e.value.content={...l}),o.value=!0});const a=b(()=>e.value.content);return(s,r)=>o.value?(c(),M(I,{key:0},{default:m(()=>[n(p,{cols:"6"},{default:m(()=>[n(v,{modelValue:a.value.avatar_gap,"onUpdate:modelValue":r[0]||(r[0]=i=>a.value.avatar_gap=i),modelModifiers:{number:!0},"hide-details":"",label:"头像到内容间距",suffix:"pixel"},null,8,["modelValue"])]),_:1}),n(p,{cols:"6"},{default:m(()=>[n(v,{modelValue:a.value.username_to_badge,"onUpdate:modelValue":r[1]||(r[1]=i=>a.value.username_to_badge=i),modelModifiers:{number:!0},"hide-details":"",label:"用户名到徽章距离",suffix:"pixel"},null,8,["modelValue"])]),_:1}),n(p,{cols:"6"},{default:m(()=>[n(v,{modelValue:a.value.content_gap,"onUpdate:modelValue":r[2]||(r[2]=i=>a.value.content_gap=i),modelModifiers:{number:!0},"hide-details":"",label:"用户信息到内容间距",suffix:"pixel"},null,8,["modelValue"])]),_:1}),n(p,{cols:"6"},{default:m(()=>[n(v,{modelValue:a.value.badge_gap,"onUpdate:modelValue":r[3]||(r[3]=i=>a.value.badge_gap=i),modelModifiers:{number:!0},"hide-details":"",label:"徽章间距",suffix:"pixel"},null,8,["modelValue"])]),_:1})]),_:1})):_("",!0)}});async function F(t,e,l){const[o,a]=X(l),s=e.themes.content,r=await(async()=>{const V=(()=>{let d=0;return t.shared.logos.admiral&&(d+=1),t.shared.logos.captain&&(d+=1),t.shared.logos.governor&&(d+=1),t.shared.logos.manager&&(d+=1),d})();if(V===0)return{content:"",url:""};o.height=e.shared.chat_logo_size,o.width=e.shared.chat_logo_size*V+(V-1)*s.badge_gap+s.username_to_badge;let C=s.username_to_badge;const q=k();for(const[d,A]of[[t.shared.logos.manager,"special/房管"],[t.shared.logos.governor,"special/总督"],[t.shared.logos.admiral,"special/提督"],[t.shared.logos.captain,"special/舰长"]]){if(!d)continue;const E=q.find_emote(A),j=await(await fetch(E)).blob(),$=await window.createImageBitmap(j,{resizeHeight:e.shared.chat_logo_size,resizeWidth:e.shared.chat_logo_size,resizeQuality:"high"});a.drawImage($,C,0),$.close(),C+=e.shared.chat_logo_size+s.badge_gap}return await S(await z(o),{width:o.width,height:o.height},1,"sub",void 0,{before:!1,after:!1})})();a.font=`${e.shared.chat_font_size}px "${e.shared.font_family}"`,a.textRendering="optimizeLegibility",a.fillStyle="white";const i=e.shared.chat_width_limit-e.shared.chat_avatar_size-s.avatar_gap,U=t.themed.content.name_color.toLowerCase()==="#ffffff"?"":`[:color:${t.themed.content.name_color}:]`,L=t.themed.content.name_color.toLowerCase()==="#ffffff"?"":"[:color:#ffffff:]",R=`${U}${t.shared.username}：${L}${r.content}[:space:${s.content_gap}px:]${t.shared.content}`,{image:D}=await G(R,e.shared,i,o);URL.revokeObjectURL(r.url);const N=await Y(t.shared.avatar,a,e.shared.chat_avatar_size),g=await window.createImageBitmap(N),x=await window.createImageBitmap(D);return o.height=Math.max(g.height,x.height),o.width=g.width+s.avatar_gap+x.width,a.drawImage(g,0,0),a.drawImage(x,g.width+s.avatar_gap,0),{image:await z(o),canvas:o}}async function me(t,e,l){return{render:await window.createImageBitmap((await F(t,e,l.canvas)).image)}}const Ve={name:w,global_configure:ce,display:ie,editor:de,prepare_chat:Z,render:F,prepare_entering_animation:()=>({}),prepare_rendering:me};export{Ve as default};
