class u{}function m(i){const t=i??new OffscreenCanvas(0,0),e=t.getContext("2d");return[t,e]}function w(i,t){switch(t){case"horizontal":return{length:i.width,breadth:i.height};case"vertical":return{length:i.height,breadth:i.width}}}function y(i,t){switch(t){case"horizontal":return{width:i.length,height:i.breadth};case"vertical":return{width:i.breadth,height:i.length}}}function _(i){switch(i){case"default":return-1;case"inverse":return 1}}async function p(i,t,e){const a=await window.createImageBitmap(await(await fetch(i)).blob(),{resizeHeight:e,resizeWidth:e,resizeQuality:"high"});t.canvas.height=e,t.canvas.width=e,t.beginPath(),t.arc(e/2,e/2,e/2,0,Math.PI*2,!0),t.clip(),t.drawImage(a,0,0);const s=t.canvas;return await(s instanceof OffscreenCanvas?s.convertToBlob({type:"image/png"}):new Promise((o,r)=>{s.toBlob(n=>o(n),"image/png")}))}function b(i,t,e,a){const s=Math.min(e.height,e.width)/2,h=Array.isArray(a)?a.map(n=>Math.min(n,s)):Array.from({length:4}).fill(Math.min(a,s)),r=[{x:t.x+h[0],y:t.y+h[0]},{x:t.x+e.width-h[1],y:t.y+h[1]},{x:t.x+e.width-h[2],y:t.y+e.height-h[2]},{x:t.x+h[3],y:t.y+e.height-h[3]}].map((n,c)=>[n,h[c]]);i.beginPath();for(const[n,[c,d]]of r.entries()){const g=Math.PI/2*n;i.arc(c.x,c.y,d,Math.PI+g,Math.PI*3/2+g,!1)}return i.closePath(),i.fill(),r}function v(i,t,e,a="#c64dbe"){const s=i.strokeStyle;i.strokeStyle=a,i.beginPath(),i.moveTo(t.x,t.y),i.lineTo(e.x,e.y),i.stroke(),i.closePath(),i.strokeStyle=s}async function P(i){return i instanceof OffscreenCanvas?i.convertToBlob({type:"image/png"}):new Promise((e,a)=>{i.toBlob(s=>e(s),"image/png")})}function x(i,t){return[...i.children].map((a,s)=>({chat:t[s],element:a}))}function C(i,t,e){const a=[];for(const{chat:s,element:h}of i){const{animation:o,revoke:r}=e.shared.selected_theme.prepare_entering_animation(s,h,e);o&&t.push(o),r&&a.push(r)}return a}function T(i,t,e,a){return async()=>{await new Promise((s,h)=>{setTimeout(s,i)}),await t(),await new Promise((s,h)=>{setTimeout(s,e)}),a()}}class f{static#t="http://localhost:8020/";constructor(){}static async build(t,e){return await fetch(f.#t,{method:"POST",body:JSON.stringify({method:"begin",fps:t,height:e.height,width:e.width}),headers:{"Content-Type":"application/json"}}),new f}async add_frame(t){return await fetch(f.#t,{method:"POST",body:t,headers:{"Content-Type":"image/png"}})}async close(){return await fetch(f.#t,{method:"POST",body:JSON.stringify({method:"end"}),headers:{"Content-Type":"application/json"}})}}function l(i,t){return!(i.topleft.x>t.bottomright.x||i.bottomright.x<t.topleft.x||i.topleft.y>t.bottomright.y||i.bottomright.y<t.topleft.y)}class I{#t=void 0;#a;#e;#s=void 0;#i=void 0;#h=!1;#n=!1;constructor(t,e){t instanceof u?this.#t=t:(this.#s=t.render,this.#i=t.render_pass2),this.#e={...e},this.#a={...e}}async update_position(t,e){if(this.#e.x=this.#a.x+t.width,this.#e.y=this.#a.y+t.height,this.#t||this.#s){const a=this.#t?.size??{height:this.#s.height,width:this.#s.width},s={topleft:this.#e,bottomright:{x:this.#e.x+a.width,y:this.#e.y+a.height}};l(e,s)||(this.#h=!0,this.#s&&(this.#s.close(),this.#s=void 0))}if(this.#i){const a={topleft:{x:this.#e.x+(this.#i.offset?.width??0),y:this.#e.y+(this.#i.offset?.height??0)},bottomright:{x:this.#e.x+(this.#i.offset?.width??0)+this.#i.image.width,y:this.#e.y+(this.#i.offset?.height??0)+this.#i.image.height}};l(e,a)||(this.#i.image.close(),this.#i=void 0)}if(this.#t)if(this.#s&&(!this.#t.render_pass2||this.#i))await this.#t.free(),this.#t=void 0;else return this.#n;return this.#s===void 0&&this.#i===void 0}render(t,e,a){if(this.#t&&!this.#s){const s=this.#t.render(t,e,{topleft:this.#e,out_of_scene:this.#h},a);s===!1?this.#n=!0:s instanceof ImageBitmap&&(this.#s=s,t.drawImage(this.#s,this.#e.x,this.#e.y))}this.#s&&t.drawImage(this.#s,this.#e.x,this.#e.y)}render_pass2(t,e,a){if(this.#t&&this.#t.render_pass2&&!this.#i){const s=this.#t.render_pass2(t,e,{topleft:this.#e,out_of_scene:this.#h},a);s===!1?this.#n=!0:s!==!0&&(this.#i=s)}if(this.#i){const s=this.#i.image,h=this.#i.offset??{height:0,width:0};t.drawImage(s,this.#e.x+h.width,this.#e.y+h.height)}}async free(){this.#t&&await this.#t.free(),this.#s&&this.#s.close(),this.#i&&this.#i.image.close()}}class k{time;#t;#a;constructor(t,e){this.time=t,this.#t=e?.easing??(a=>a),this.#a=e?.value}get_ratio(t){return t<this.time.start?0:t>this.time.end?1:this.#t((t-this.time.start)/(this.time.end-this.time.start))}get_value(t,e,a){const s=e??this.#a?.start,h=a??this.#a?.end;return s===void 0||h===void 0?0:s+(h-s)*this.get_ratio(t)}}export{k as A,I as C,u as R,f as S,y as a,C as b,P as c,T as d,v as e,m as f,_ as g,p as h,b as i,x as p,w as t};
