import{_ as I,p as N}from"./ParagraphDisplay.vue_vue_type_script_setup_true_lang-Cg7Y1RDg.js";import{aj as F}from"./resizeObserver-B_eoUIIx.js";import{B as T,m as g,g as x,d as S,c as V,x as l,y as X,u as o,M as D,o as Y,r as Z,l as j,R as G,q as w}from"./pinia-CYavoQC1.js";import{_ as O,A as b,U as y,z as H}from"./VTextField-dhpxJfRw.js";import{A as z}from"./utility-CQuTnSxM.js";import{e as B}from"./easing-functions-Pc8ZxzqX.js";import{p as J,C as Q,c as W}from"./rendering-CVLbwh7J.js";import{R as ee}from"./interface-D6jMlKpV.js";import"./dialog-Buob4eiQ.js";import"./emotes-DeEw5HnO.js";import"./tag-DEJUn8pt.js";const te="_hide-before-start_e207e82",E={"hide-before-start":te};function ae(i,e,a){if(a.shared.selected_mode.name==="danmaku")return{};const t=e.querySelector(".username-content"),s=e.querySelectorAll(".username-marker"),r=e.querySelector(".divider"),d=e.querySelector(".content"),n=e.querySelectorAll(".star.username-side"),v=e.querySelector(".star.content-side"),u=[t,...s,r,d,...n,v];for(const _ of u)_.classList.add(E["hide-before-start"]);const m={duration:a.shared.enter_duration,delay:i.shared.enter_millisecond+a.shared.lift_duration,fill:"forwards"},p=[new Animation(new KeyframeEffect(t,[{transform:"none",easing:"ease-out"},{transform:"translateY(-40%)",easing:"ease-in-out"},{transform:"none"}],{...m})),new Animation(new KeyframeEffect(t,[{opacity:0},{opacity:1}],{easing:"ease-out",...m})),new Animation(new KeyframeEffect(r,[{opacity:0,transform:"translateX(-10%)"},{opacity:1,transform:"none"}],{easing:"ease-out",...m})),new Animation(new KeyframeEffect(d,[{opacity:0,transform:"translateX(40%)"},{opacity:1,transform:"none"}],{easing:"ease-out",...m}))];for(const _ of s)p.push(new Animation(new KeyframeEffect(_,[{opacity:0,transform:"translateY(-100%)"},{opacity:1,transform:"none"}],{easing:"ease-out",...m})));for(const _ of n)p.push(new Animation(new KeyframeEffect(_,[{opacity:0,transform:"scale(0.6)"},{opacity:1,transform:"none"}],{easing:"ease-out",...m})));return p.push(new Animation(new KeyframeEffect(v,[{opacity:0,transform:"translateY(40%)"},{opacity:1,transform:"none"}],{easing:"ease-out",...m}))),{animation:p,revoke:()=>{for(const _ of u)_.classList.remove(E["hide-before-start"])}}}const $="简洁轻动画";function se(i){i.themed.theme!==$&&(i.themed.content={})}const re={xmlns:"http://www.w3.org/2000/svg","xml:space":"preserve",viewBox:"0 0 180 180"};function de(i,e){return g(),T("svg",re,[...e[0]||(e[0]=[x("path",{d:"m90 0-.054.055C78.931 62.929 59.571 78.965.411 89.59L0 89.998l.41.411c59.16 10.627 78.52 26.662 89.536 89.536L90 180l.054-.055c11.015-62.874 30.376-78.91 89.535-89.536l.411-.411-.41-.407C120.43 78.964 101.07 62.929 90.053.055Z",style:{"fill-opacity":"1",stroke:"none"}},null,-1)])])}const L={render:de},ne={class:"chat-container container"},ie={class:"username-line"},le={class:"username-content"},oe={class:"content-side-star-helper"},me={class:"content"},_e=S({__name:"Display",props:{chatConfig:{},globalConfig:{}},setup(i){F(r=>({v36c7bdb8:`${t.value.box_padding}px`,v7be88d3e:`${t.value.username_marker_gap}px`,v14ef776c:`${t.value.username_marker_size}px`,d5162a56:s.value,a82d1708:`${t.value.divider_height}px`,v5a848c27:`${t.value.divider_width}px`,v6edc64fa:`${t.value.divider_margin}px`,d30514f2:`${t.value.content_width}px`,v27815bd6:`${t.value.larger_star_size}px`,v82664a6c:`${t.value.smaller_star_size}px`,v20c50fd0:`${t.value.username_star_blink_rate}ms`,v244b1f53:`${t.value.content_star_blink_rate}ms`}));const e=i,a=V(()=>({shared:e.chatConfig.shared,themed:e.chatConfig.themed.content})),t=V(()=>e.globalConfig.content),s=V(()=>{const r=t.value.username_marker_size/5;return`path("M ${r*2} 0 L ${r*3} 0 L ${r*3} ${r*2} L ${r*5} ${r*2} L ${r*5} ${r*3} L ${r*3} ${r*3} L ${r*3} ${r*5} L ${r*2} ${r*5} L ${r*2} ${r*3} L 0 ${r*3} L 0 ${r*2} L ${r*2} ${r*2} Z")`});return(r,d)=>{const n=I;return g(),T("div",ne,[x("div",ie,[d[0]||(d[0]=x("div",{class:"username-marker"},null,-1)),x("div",le,X(a.value.shared.username),1),d[1]||(d[1]=x("div",{class:"username-marker"},null,-1)),l(o(L),{class:"star large-star username-side animated"}),l(o(L),{class:"star small-star username-side animated"})]),d[2]||(d[2]=x("div",{class:"divider"},null,-1)),x("div",oe,[x("span",me,[l(n,{paragraph:a.value.shared.content},null,8,["paragraph"])]),l(o(L),{class:"star large-star content-side animated"})])])}}}),he=O(_e,[["__scopeId","data-v-4969a3a1"]]),ue={style:{"text-align":"center"}},pe=S({__name:"Editor",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(i){return D(i,"modelValue"),(e,a)=>(g(),T("div",ue,"无可配置内容"))}}),fe=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg
   viewBox="0 0 180 180"
   version="1.1"
   id="svg1"
   xml:space="preserve"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:svg="http://www.w3.org/2000/svg"><defs
     id="defs1" /><g
     id="layer1"><path
       id="path2"
       style="fill-opacity:1;stroke:none;"
       d="m 90.000002,0 -0.05355,0.0548699 C 78.930803,62.929195 59.570505,78.96432 0.410552,89.590784 L 0,89.997745 0.410552,90.409278 c 59.159949,10.626462 78.520251,26.661582 89.5359,89.535922 l 0.05355,0.0548 0.05355,-0.0548 C 101.06921,117.07092 120.42954,101.03573 179.58945,90.409278 L 180,89.997745 179.58945,89.590784 C 120.42953,78.964322 101.0692,62.929146 90.053553,0.05486993 Z" /></g></svg>
`,K=document.createElement("img"),ce=S({__name:"GlobalConfig",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(i){const e=D(i,"modelValue"),a={box_padding:12,username_marker_size:18,username_marker_gap:12,divider_margin:8,divider_width:350,divider_height:4,content_width:300,larger_star_size:18,smaller_star_size:12,username_star_blink_rate:2e3,content_star_blink_rate:1500},t=Z(!1);Y(()=>{e.value.theme!==$&&(e.value.theme=$,e.value.content={...a});const d=new DOMParser().parseFromString(fe,"image/svg+xml");d.documentElement.setAttribute("fill","white");const n=new XMLSerializer;K.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(n.serializeToString(d)),t.value=!0});const s=V(()=>e.value.content);return(r,d)=>t.value?(g(),j(H,{key:0},{default:w(()=>[l(b,{cols:"6"},{default:w(()=>[l(y,{modelValue:o(s).box_padding,"onUpdate:modelValue":d[0]||(d[0]=n=>o(s).box_padding=n),modelModifiers:{number:!0},"hide-details":"",label:"包围盒内间距",suffix:"pixel"},null,8,["modelValue"])]),_:1}),l(b,{cols:"6"},{default:w(()=>[l(y,{modelValue:o(s).username_marker_size,"onUpdate:modelValue":d[1]||(d[1]=n=>o(s).username_marker_size=n),modelModifiers:{number:!0},"hide-details":"",label:"用户名标识尺寸",suffix:"pixel"},null,8,["modelValue"])]),_:1}),l(b,{cols:"6"},{default:w(()=>[l(y,{modelValue:o(s).username_marker_gap,"onUpdate:modelValue":d[2]||(d[2]=n=>o(s).username_marker_gap=n),modelModifiers:{number:!0},"hide-details":"",label:"用户名标识与用户名间距",suffix:"pixel"},null,8,["modelValue"])]),_:1}),l(b,{cols:"6"},{default:w(()=>[l(y,{modelValue:o(s).divider_margin,"onUpdate:modelValue":d[3]||(d[3]=n=>o(s).divider_margin=n),modelModifiers:{number:!0},"hide-details":"",label:"分隔线两侧间距",suffix:"pixel"},null,8,["modelValue"])]),_:1}),l(b,{cols:"6"},{default:w(()=>[l(y,{modelValue:o(s).divider_width,"onUpdate:modelValue":d[4]||(d[4]=n=>o(s).divider_width=n),modelModifiers:{number:!0},"hide-details":"",label:"分隔线长度",suffix:"pixel"},null,8,["modelValue"])]),_:1}),l(b,{cols:"6"},{default:w(()=>[l(y,{modelValue:o(s).divider_height,"onUpdate:modelValue":d[5]||(d[5]=n=>o(s).divider_height=n),modelModifiers:{number:!0},"hide-details":"",label:"分隔线宽度",suffix:"pixel"},null,8,["modelValue"])]),_:1}),l(b,{cols:"6"},{default:w(()=>[l(y,{modelValue:o(s).content_width,"onUpdate:modelValue":d[6]||(d[6]=n=>o(s).content_width=n),modelModifiers:{number:!0},"hide-details":"",label:"内容最大宽度",suffix:"pixel"},null,8,["modelValue"])]),_:1}),l(b,{cols:"6"},{default:w(()=>[l(y,{modelValue:o(s).larger_star_size,"onUpdate:modelValue":d[7]||(d[7]=n=>o(s).larger_star_size=n),modelModifiers:{number:!0},"hide-details":"",label:"大星星尺寸",suffix:"pixel"},null,8,["modelValue"])]),_:1}),l(b,{cols:"6"},{default:w(()=>[l(y,{modelValue:o(s).smaller_star_size,"onUpdate:modelValue":d[8]||(d[8]=n=>o(s).smaller_star_size=n),modelModifiers:{number:!0},"hide-details":"",label:"小星星尺寸",suffix:"pixel"},null,8,["modelValue"])]),_:1}),l(b,{cols:"6"},{default:w(()=>[l(y,{modelValue:o(s).username_star_blink_rate,"onUpdate:modelValue":d[9]||(d[9]=n=>o(s).username_star_blink_rate=n),modelModifiers:{number:!0},"hide-details":"",label:"用户名侧星星闪烁周期",suffix:"ms"},null,8,["modelValue"])]),_:1}),l(b,{cols:"6"},{default:w(()=>[l(y,{modelValue:o(s).content_star_blink_rate,"onUpdate:modelValue":d[10]||(d[10]=n=>o(s).content_star_blink_rate=n),modelModifiers:{number:!0},"hide-details":"",label:"内容侧星星闪烁周期",suffix:"ms"},null,8,["modelValue"])]),_:1})]),_:1})):G("",!0)}});function ve(i,e){const a=e.measureText(i.username),t={height:a.fontBoundingBoxAscent+a.fontBoundingBoxDescent,width:a.actualBoundingBoxLeft+a.actualBoundingBoxRight};return{size:t,render:(s,r)=>{s.fillText(i.username,r.x-t.width/2-a.actualBoundingBoxLeft,r.y-a.fontBoundingBoxDescent)}}}function R(i,e,a){const t=i.username_marker_size/5;e.beginPath(),e.moveTo(a.x+2*t,a.y+0*t),e.lineTo(a.x+3*t,a.y+0*t),e.lineTo(a.x+3*t,a.y+2*t),e.lineTo(a.x+5*t,a.y+2*t),e.lineTo(a.x+5*t,a.y+3*t),e.lineTo(a.x+3*t,a.y+3*t),e.lineTo(a.x+3*t,a.y+5*t),e.lineTo(a.x+2*t,a.y+5*t),e.lineTo(a.x+2*t,a.y+3*t),e.lineTo(a.x+0*t,a.y+3*t),e.lineTo(a.x+0*t,a.y+2*t),e.lineTo(a.x+2*t,a.y+2*t),e.closePath(),e.fill()}function C(i,e,a){e.drawImage(K,a.x,a.y,i,i)}async function P(i,e,a){const t=a.measureText("x"),s=t.actualBoundingBoxAscent+t.actualBoundingBoxDescent,{size:r,render:d}=ve(i,a),{size:n,render:v,release:u}=await N(i.content,e.shared,e.themed.content_width,a.canvas,{alignment:"center"}),m={width:r.width+(e.themed.username_marker_gap+e.themed.username_marker_size)*2,height:Math.max(e.themed.username_marker_size,r.height)},p={width:Math.max(m.width,e.themed.divider_width,n.width)+2*e.themed.box_padding,height:m.height+e.themed.divider_height+e.themed.divider_margin*2+n.height+2*e.themed.box_padding};return{bounding_box:p,username:{size:r,render:(_,f,h)=>{const c={x:f.x+p.width/2,y:f.y+e.themed.box_padding+(m.height+r.height)/2};d(_,{x:c.x+h.width,y:c.y+h.height})}},content:{size:n,render:(_,f,h)=>{const c={x:f.x+(p.width-n.width)/2,y:f.y+e.themed.box_padding+m.height+e.themed.divider_margin*2+e.themed.divider_height};v(_,{x:c.x+h.width,y:c.y+h.height})},release:u},render_mark:(_,f,h)=>{const c={x:f.x+p.width/2,y:f.y+e.themed.box_padding+(m.height-e.themed.username_marker_size)/2};R(e.themed,_,{x:c.x-r.width/2-e.themed.username_marker_gap-e.themed.username_marker_size+h.width,y:c.y+h.height}),R(e.themed,_,{x:c.x+r.width/2+e.themed.username_marker_gap+h.width,y:c.y+h.height})},render_divider:(_,f,h)=>{const c={x:f.x+(p.width-e.themed.divider_width)/2,y:f.y+e.themed.box_padding+m.height+e.themed.divider_margin};_.fillRect(c.x+h.width,c.y+h.height,e.themed.divider_width,e.themed.divider_height)},render_username_diamond:(_,f,h,c)=>{const k={x:f.x+e.themed.box_padding+h.width,y:f.y+e.themed.box_padding+m.height+h.height},U={x:k.x+s/4+e.themed.smaller_star_size/2,y:k.y-s/4-e.themed.smaller_star_size/2},M=e.themed.smaller_star_size*c;C(M,_,{x:U.x-M/2,y:U.y-M/2});const q={x:k.x+e.shared.chat_font_size/2+e.themed.larger_star_size/2,y:k.y-e.shared.chat_font_size/4-s/2-e.themed.larger_star_size/2},A=e.themed.larger_star_size*c;C(A,_,{x:q.x-A/2,y:q.y-A/2})},render_content_diamond:(_,f,h)=>{C(e.themed.larger_star_size,_,{x:f.x+p.width-e.themed.box_padding-e.themed.larger_star_size+h.width,y:f.y+e.themed.box_padding+m.height+e.themed.divider_margin*2+e.themed.divider_height+e.shared.chat_font_size/4+h.height})}}}async function we(i,e,a){const[t,s]=J(a),r=e.themes.content;s.font=`${e.shared.chat_font_size}px "${e.shared.font_family}"`,s.textRendering="optimizeLegibility",s.fillStyle="white";const d=new Q(s),n=await P(i.shared,{shared:e.shared,themed:r},s);t.height=n.bounding_box.height,t.width=n.bounding_box.width,d.apply(s);const v={x:0,y:0},u={width:0,height:0};return n.render_username_diamond(s,v,u,1),n.render_content_diamond(s,v,u),n.render_mark(s,v,u),n.username.render(s,v,u),n.render_divider(s,v,u),n.content.render(s,v,u),await n.content.release(),{image:await W(t),canvas:t}}class be extends ee{size;render_pass2=void 0;#e;#s;#r;#d;#a;#t;constructor(e,a,t){super(),this.#e=e,this.size=this.#e.bounding_box,this.#s=t.themed.larger_star_size,this.#r=t.themed.username_marker_size,this.#d=t.themed.divider_width;{const s=new z({start:0,end:t.themed.username_star_blink_rate/2},{easing:B.ease_in_out_quad,value:{start:0,end:1}}),r=new z({start:0,end:t.themed.content_star_blink_rate/2},{easing:B.ease_in_out_quad,value:{start:0,end:1}}),d=Math.round(Math.random()*t.themed.username_star_blink_rate),n=Math.round(Math.random()*t.themed.content_star_blink_rate);this.#a={username:v=>{const u=(d+v)%t.themed.username_star_blink_rate,m=u%Math.round(t.themed.username_star_blink_rate/2),p=s.get_value(m);return m<u?p:1-p},content:v=>{const u=(n+v)%t.themed.content_star_blink_rate,m=u%Math.round(t.themed.content_star_blink_rate/2),p=r.get_value(m);return m<u?p:1-p}}}this.#t=t.shared.selected_mode.name==="danmaku"?void 0:{username:new z({start:a.enter_millisecond+t.shared.lift_duration,end:a.enter_millisecond+t.shared.lift_duration+t.shared.enter_duration},{easing:s=>1-4*Math.pow(s-.5,2)}),other:new z({start:a.enter_millisecond+t.shared.lift_duration,end:a.enter_millisecond+t.shared.lift_duration+t.shared.enter_duration},{easing:B.ease_out_cubic})}}render(e,a,t,s){if(t.out_of_scene)return!1;if(e.fillStyle="white",this.#t===void 0){const r={width:0,height:0},d=e.globalAlpha;e.globalAlpha=this.#a.username(s.current_time),this.#e.render_username_diamond(e,t.topleft,r,1),e.globalAlpha=this.#a.content(s.current_time),this.#e.render_content_diamond(e,t.topleft,r),e.globalAlpha=d,this.#e.render_mark(e,t.topleft,r),this.#e.username.render(e,t.topleft,r),this.#e.render_divider(e,t.topleft,r),this.#e.content.render(e,t.topleft,r)}else{const r=e.globalAlpha,d=this.#t.other.get_ratio(s.current_time),n=d;e.globalAlpha=n*this.#a.username(s.current_time),this.#e.render_username_diamond(e,t.topleft,{width:0,height:0},.6+.4*d),e.globalAlpha=n*this.#a.content(s.current_time),this.#e.render_content_diamond(e,t.topleft,{width:0,height:.4*this.#s*(1-d)}),e.globalAlpha=n,this.#e.render_mark(e,t.topleft,{width:0,height:this.#r*(d-1)}),this.#e.username.render(e,t.topleft,{width:0,height:-this.#e.username.size.height*.4*this.#t.username.get_ratio(s.current_time)}),this.#e.render_divider(e,t.topleft,{width:.1*this.#d*(d-1),height:0}),this.#e.content.render(e,t.topleft,{width:.4*this.#e.content.size.width*(1-d),height:0}),e.globalAlpha=r,this.#t.other.time.end<=s.current_time&&(this.#t=void 0)}return!0}async free(){await this.#e.content.release()}}async function ye(i,e,a){a.font=`${e.shared.chat_font_size}px "${e.shared.font_family}"`,a.textRendering="optimizeLegibility";const t=await P(i.shared,{shared:e.shared,themed:e.themes.content},a);return new be(t,i.shared,{shared:e.shared,themed:e.themes.content})}const Te={name:$,global_configure:ce,display:he,editor:pe,prepare_chat:se,render:we,prepare_entering_animation:ae,prepare_rendering:ye};export{Te as default};
