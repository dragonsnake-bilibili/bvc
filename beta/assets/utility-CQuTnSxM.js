import{R as d}from"./interface-D6jMlKpV.js";function c(h,t){return[...h.children].map((e,s)=>({chat:t[s],element:e}))}function m(h,t,i){const e=[];for(const{chat:s,element:a}of h){const{animation:o,revoke:r}=i.shared.selected_theme.prepare_entering_animation(s,a,i);o&&t.push(...o),r&&e.push(r)}return e}function u(h,t,i,e){return async()=>{await new Promise((s,a)=>{setTimeout(s,h)}),await t(),await new Promise((s,a)=>{setTimeout(s,i)}),e()}}class f{#t;constructor(t){this.#t=t}static async build(t,i,e){const s=`http://localhost:${t}/`;return await fetch(s,{method:"POST",body:JSON.stringify({method:"begin",fps:i,height:e.height,width:e.width}),headers:{"Content-Type":"application/json"}}),new f(s)}async add_frame(t){const i=t.getImageData(0,0,t.canvas.width,t.canvas.height);return await fetch(this.#t,{method:"POST",body:i.data,headers:{"Content-Type":"application/octet-stream"}})}async close(){return await fetch(this.#t,{method:"POST",body:JSON.stringify({method:"end"}),headers:{"Content-Type":"application/json"}})}}function n(h,t){return!(h.topleft.x>t.bottomright.x||h.bottomright.x<t.topleft.x||h.topleft.y>t.bottomright.y||h.bottomright.y<t.topleft.y)}class g{#t=void 0;#h;#s;#e=void 0;#i=void 0;#a={pass1:!1,pass2:!1};#o=!1;#r=!1;constructor(t,i){t instanceof d?this.#t=t:(this.#e=t.render,this.#i=t.render_pass2),this.#s={...i},this.#h={...i}}async update_position(t,i){if(this.#s.x=this.#h.x+t.width,this.#s.y=this.#h.y+t.height,this.#t||this.#e){const e=this.#t?.size??{height:this.#e.height,width:this.#e.width},s={topleft:this.#s,bottomright:{x:this.#s.x+e.width,y:this.#s.y+e.height}};n(i,s)?this.#a.pass1=!0:this.#a.pass1&&(this.#o=!0,this.#e&&(this.#e.close(),this.#e=void 0))}if(this.#i){const e={topleft:{x:this.#s.x+(this.#i.offset?.width??0),y:this.#s.y+(this.#i.offset?.height??0)},bottomright:{x:this.#s.x+(this.#i.offset?.width??0)+this.#i.image.width,y:this.#s.y+(this.#i.offset?.height??0)+this.#i.image.height}};n(i,e)?this.#a.pass2=!0:this.#a.pass2&&(this.#i.image.close(),this.#i=void 0)}if(this.#t)if(this.#e&&(!this.#t.render_pass2||this.#i))await this.#t.free(),this.#t=void 0;else return this.#r;return this.#e===void 0&&this.#i===void 0}render(t,i,e){if(this.#t&&!this.#e){const s=this.#t.render(t,i,{topleft:this.#s,out_of_scene:this.#o},e);s===!1?this.#r=!0:s instanceof ImageBitmap&&(this.#e=s,t.drawImage(this.#e,this.#s.x,this.#s.y))}this.#e&&t.drawImage(this.#e,this.#s.x,this.#s.y)}render_pass2(t,i,e){if(this.#t&&this.#t.render_pass2&&!this.#i){const s=this.#t.render_pass2(t,i,{topleft:this.#s,out_of_scene:this.#o},e);s===!1?this.#r=!0:s!==!0&&(this.#i=s)}if(this.#i){const s=this.#i.image,a=this.#i.offset??{height:0,width:0};t.drawImage(s,this.#s.x+a.width,this.#s.y+a.height)}}async free(){this.#t&&await this.#t.free(),this.#e&&this.#e.close(),this.#i&&this.#i.image.close()}}class p{time;#t;#h;constructor(t,i){this.time=t,this.#t=i?.easing??(e=>e),this.#h=i?.value}get_ratio(t){const i=t<this.time.start?this.time.start:t>this.time.end?this.time.end:t;return this.#t((i-this.time.start)/(this.time.end-this.time.start))}get_value(t,i,e){const s=i??this.#h?.start,a=e??this.#h?.end;return s===void 0||a===void 0?0:s+(a-s)*this.get_ratio(t)}}export{p as A,g as C,f as S,u as a,m as g,c as p};
