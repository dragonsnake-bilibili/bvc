import{_ as S,r as A}from"./ParagraphDisplay.vue_vue_type_script_setup_true_lang-Cg7Y1RDg.js";import{aj as D}from"./resizeObserver-B_eoUIIx.js";import{u as L}from"./emotes-DeEw5HnO.js";import{i as N}from"./interface-D6jMlKpV.js";import{d as y,c as w,u as f,i as R,B as v,m as h,g as c,R as g,y as T,x as d,M as C,l as k,q as i,o as j,r as q}from"./pinia-CYavoQC1.js";import{_ as E,A as u,z as M,U as m}from"./VTextField-dhpxJfRw.js";import{v as U}from"./VColorPicker-DcrqMdfC.js";import{p as G,e as O,d as I,c as P}from"./rendering-CVLbwh7J.js";import"./dialog-Buob4eiQ.js";import"./tag-DEJUn8pt.js";const V="菲可变高度卡片";function H(s){if(s.themed.theme!==V){const a={color:"#ffffff"};s.themed.content={...a}}}const Q={class:"chat-container container"},W={class:"user-info"},J=["src"],K={class:"username"},X=["src"],Y=["src"],Z=["src"],ee=["src"],ae={class:"content-controller"},te=y({__name:"Display",props:{chatConfig:{},globalConfig:{}},setup(s){D(l=>({f0b9e3de:`${t.value.card_radius}px`,v4adf6941:`${f(n).chat_width_limit}px`,v55623fb4:`${t.value.card_height}px`,v91e795f0:`${t.value.card_padding}px`,v4025f0ee:t.value.card_background,v432ad22c:`${t.value.transparent_ratio*100}%`,v6907c0a4:`${t.value.username_to_content}px`,v3bad9dae:`${t.value.username_font_size}px`,v8c355462:e.value.themed.color,v38fa1858:`${t.value.username_to_badge}px`,v41e3966a:`${t.value.badge_gap}px`,v0b3f3730:`${t.value.content_width}px`,v74d7b32a:`${t.value.content_lines*1.5}em`,v695d6bc9:`${e.value.themed.color}`}));const a=L(),n=R(N),r=s,e=w(()=>({shared:r.chatConfig.shared,themed:r.chatConfig.themed.content})),t=w(()=>r.globalConfig.content);return(l,o)=>{const B=S;return h(),v("div",Q,[c("div",W,[c("img",{class:"chat-avatar",src:e.value.shared.avatar},null,8,J),o[0]||(o[0]=c("div",{class:"background-layer"},null,-1)),c("span",K,T(e.value.shared.username),1),e.value.shared.logos.manager?(h(),v("img",{key:0,class:"chat-logo",src:f(a).find_emote("special/房管")},null,8,X)):g("",!0),e.value.shared.logos.governor?(h(),v("img",{key:1,class:"chat-logo",src:f(a).find_emote("special/总督")},null,8,Y)):g("",!0),e.value.shared.logos.admiral?(h(),v("img",{key:2,class:"chat-logo",src:f(a).find_emote("special/提督")},null,8,Z)):g("",!0),e.value.shared.logos.captain?(h(),v("img",{key:3,class:"chat-logo",src:f(a).find_emote("special/舰长")},null,8,ee)):g("",!0)]),c("div",ae,[d(B,{paragraph:e.value.shared.content},null,8,["paragraph"])])])}}}),le=E(te,[["__scopeId","data-v-face839b"]]),oe=y({__name:"Editor",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(s){const a=C(s,"modelValue"),n=w(()=>a.value.content);return(r,e)=>(h(),k(M,null,{default:i(()=>[d(u,{class:"mx-auto",cols:"6"},{default:i(()=>[c("div",null,[e[1]||(e[1]=c("p",{style:{"text-align":"center"}},"文字颜色",-1)),d(U,{modelValue:n.value.color,"onUpdate:modelValue":e[0]||(e[0]=t=>n.value.color=t),class:"mx-auto","show-swatches":"",swatches:[["#007FFF"],["#B040F0"],["#FFFFFF"]]},null,8,["modelValue"])])]),_:1})]),_:1}))}}),se=y({__name:"GlobalConfig",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(s){const a=C(s,"modelValue"),n={card_height:160,card_radius:18,card_padding:12,content_width:200,content_lines:2,card_background:"#00000066",transparent_ratio:.9,username_font_size:14,username_to_badge:8,username_to_content:12,badge_gap:6},r=q(!1);j(()=>{a.value.theme!==V&&(a.value.theme=V,a.value.content={...n}),r.value=!0});const e=w(()=>a.value.content);return(t,l)=>r.value?(h(),k(M,{key:0},{default:i(()=>[d(u,{cols:"6"},{default:i(()=>[d(m,{modelValue:e.value.card_height,"onUpdate:modelValue":l[0]||(l[0]=o=>e.value.card_height=o),modelModifiers:{number:!0},"hide-details":"",label:"卡片高度",suffix:"pixel"},null,8,["modelValue"])]),_:1}),d(u,{cols:"6"},{default:i(()=>[d(m,{modelValue:e.value.card_radius,"onUpdate:modelValue":l[1]||(l[1]=o=>e.value.card_radius=o),modelModifiers:{number:!0},"hide-details":"",label:"卡片圆角尺寸",suffix:"pixel"},null,8,["modelValue"])]),_:1}),d(u,{cols:"6"},{default:i(()=>[d(m,{modelValue:e.value.card_padding,"onUpdate:modelValue":l[2]||(l[2]=o=>e.value.card_padding=o),modelModifiers:{number:!0},"hide-details":"",label:"卡片内间距",suffix:"pixel"},null,8,["modelValue"])]),_:1}),d(u,{cols:"6"},{default:i(()=>[d(m,{modelValue:e.value.content_width,"onUpdate:modelValue":l[3]||(l[3]=o=>e.value.content_width=o),modelModifiers:{number:!0},"hide-details":"",label:"内容最大宽度",suffix:"pixel"},null,8,["modelValue"])]),_:1}),d(u,{cols:"6"},{default:i(()=>[d(m,{modelValue:e.value.content_lines,"onUpdate:modelValue":l[4]||(l[4]=o=>e.value.content_lines=o),modelModifiers:{number:!0},"hide-details":"",label:"内容最大行数"},null,8,["modelValue"])]),_:1}),d(u,{cols:"6"},{default:i(()=>[d(m,{modelValue:e.value.transparent_ratio,"onUpdate:modelValue":l[5]||(l[5]=o=>e.value.transparent_ratio=o),modelModifiers:{number:!0},"hide-details":"",label:"头像完全透明开始位置"},null,8,["modelValue"])]),_:1}),d(u,{cols:"6"},{default:i(()=>[d(m,{modelValue:e.value.username_font_size,"onUpdate:modelValue":l[6]||(l[6]=o=>e.value.username_font_size=o),modelModifiers:{number:!0},"hide-details":"",label:"用户名字体大小",suffix:"pixel"},null,8,["modelValue"])]),_:1}),d(u,{cols:"6"},{default:i(()=>[d(m,{modelValue:e.value.username_to_badge,"onUpdate:modelValue":l[7]||(l[7]=o=>e.value.username_to_badge=o),modelModifiers:{number:!0},"hide-details":"",label:"用户名到徽章距离",suffix:"pixel"},null,8,["modelValue"])]),_:1}),d(u,{cols:"6"},{default:i(()=>[d(m,{modelValue:e.value.username_to_content,"onUpdate:modelValue":l[8]||(l[8]=o=>e.value.username_to_content=o),modelModifiers:{number:!0},"hide-details":"",label:"用户名到内容距离",suffix:"pixel"},null,8,["modelValue"])]),_:1}),d(u,{cols:"6"},{default:i(()=>[d(m,{modelValue:e.value.badge_gap,"onUpdate:modelValue":l[9]||(l[9]=o=>e.value.badge_gap=o),modelModifiers:{number:!0},"hide-details":"",label:"徽章间距",suffix:"pixel"},null,8,["modelValue"])]),_:1}),d(u,{class:"mx-auto",cols:"12"},{default:i(()=>[c("div",null,[l[11]||(l[11]=c("p",{style:{"text-align":"center"}},"卡片背景",-1)),d(U,{modelValue:e.value.card_background,"onUpdate:modelValue":l[10]||(l[10]=o=>e.value.card_background=o),class:"mx-auto"},null,8,["modelValue"])])]),_:1})]),_:1})):g("",!0)}});async function de(s,a,n,r){s.canvas.height=a.chat_avatar_size,s.canvas.width=a.chat_avatar_size;const e=s.createLinearGradient((1-n.transparent_ratio)*a.chat_avatar_size,0,a.chat_avatar_size,0);e.addColorStop(0,"transparent"),e.addColorStop(1,"white"),s.fillStyle=e,I(s,{x:0,y:(a.chat_avatar_size-n.card_height)/2},{width:a.chat_avatar_size,height:n.card_height},[0,n.card_radius,n.card_radius,0],{fill:!0}),s.globalCompositeOperation="source-in";const t=await(await fetch(r.avatar)).blob(),l=await window.createImageBitmap(t,{resizeHeight:a.chat_avatar_size,resizeWidth:a.chat_avatar_size,resizeQuality:"high"});return s.drawImage(l,0,0),s.globalCompositeOperation="source-over",l.close(),await window.createImageBitmap(s.canvas)}async function F(s,a,n){const[r,e]=G(n),t=a.themes.content,l=s.themed.content,o=await(async()=>{const p=await O(s.shared,a.shared.chat_logo_size);if(p.length===0)return;r.width=a.shared.chat_logo_size*p.length+t.badge_gap*(p.length-1)+t.username_to_badge,r.height=a.shared.chat_logo_size,e.clearRect(0,0,r.width,r.height);let x=t.username_to_badge;for(const $ of p)e.drawImage($,x,0),x+=t.badge_gap+a.shared.chat_logo_size,$.close();return await window.createImageBitmap(r)})();e.fillStyle=l.color,e.font=`${a.shared.chat_font_size}px "${a.shared.font_family}"`;const{image:B}=await A(s.shared.content,a.shared,t.content_width,r,{limit_height:{maximum_lines:t.content_lines,ellipsis:!1},algorithm:"knuth-plass"}),z=await window.createImageBitmap(B),b=await de(e,a.shared,t,s.shared);r.width=a.shared.chat_width_limit,r.height=t.card_height,e.font=`${t.username_font_size}px "${a.shared.font_family}"`,e.fillStyle=t.card_background,I(e,{x:0,y:0},{width:r.width,height:r.height},t.card_radius,{fill:!0}),e.fillStyle=l.color;const _=e.measureText(s.shared.username);if(e.fillText(s.shared.username,t.card_padding+_.actualBoundingBoxLeft,t.card_padding+_.fontBoundingBoxAscent),o!==void 0){const p=e.measureText("x"),x=p.actualBoundingBoxAscent+p.actualBoundingBoxDescent;e.drawImage(o,t.card_padding+_.actualBoundingBoxLeft+_.actualBoundingBoxRight+t.username_to_badge,t.card_padding+_.fontBoundingBoxAscent-x/2-o.height/2),o.close()}return e.drawImage(z,t.card_padding,t.card_padding+_.fontBoundingBoxAscent+_.fontBoundingBoxDescent+t.username_to_content),z.close(),e.drawImage(b,r.width-b.width,(r.height-b.height)/2),b.close(),{image:await P(r),canvas:r}}async function re(s,a,n){return{render:await window.createImageBitmap((await F(s,a,n.canvas)).image)}}const ge={name:V,global_configure:se,display:le,editor:oe,prepare_chat:H,render:F,prepare_entering_animation:()=>({}),prepare_rendering:re};export{ge as default};
